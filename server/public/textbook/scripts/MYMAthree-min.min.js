function GridMake2D(e){var r,n,o,a,t,i,c,l,s;r=e.xmin,n=e.xmax,o=e.ymin,a=e.ymax,t=null!=e.crossx?e.crossx:n-r,i=null!=e.crossy?e.crossy:a-o,c=null!=e.colorx?e.colorx:16711680,l=null!=e.colory?e.colory:255,s=null!=e.colorgrid?e.colorgrid:13684944,width=n-r,height=a-o;var E=new THREE.Object3D,x=new THREE.Geometry;x.vertices.push(new THREE.Vector3(r,o,0),new THREE.Vector3(n,o,0),new THREE.Vector3(n,a,0),new THREE.Vector3(r,a,0),new THREE.Vector3(r,o,0));for(var u=r,h=o,m=width/t,w=height/i,H=0;H<t;++H)x.vertices.push(new THREE.Vector3(u,h,0)),u+=m,x.vertices.push(new THREE.Vector3(u,h,0)),h=height-h+2*o;h=o;for(var R=0;R<i;++R)x.vertices.push(new THREE.Vector3(u,h,0)),h+=w,x.vertices.push(new THREE.Vector3(u,h,0)),u=width-u+2*r;var T=new THREE.LineBasicMaterial({color:s}),p=new THREE.Line(x,T);if(o<=0&&a>=0){var y=new THREE.Geometry;y.vertices.push(new THREE.Vector3(r,0,0),new THREE.Vector3(n,0,0));var d=new THREE.LineBasicMaterial({color:c}),v=new THREE.Line(y,d)}if(r<=0&&n>=0){var f=new THREE.Geometry;f.vertices.push(new THREE.Vector3(0,o,0),new THREE.Vector3(0,a,0));var M=new THREE.LineBasicMaterial({color:l}),V=new THREE.Line(f,M)}return E.add(p),E.add(v),E.add(V),E}function GridMake3D(e){var r,n,o,a,t,i,c,l,s,E,x,u,h;r=e.xmin,n=e.xmax,o=e.ymin,a=e.ymax,t=e.zmin,i=e.zmax,c=null!=e.crossx?e.crossx:n-r,l=null!=e.crossy?e.crossy:a-o,s=null!=e.crossz?e.crossz:i-t,E=null!=e.colorx?e.colorx:16711680,x=null!=e.colory?e.colory:255,u=null!=e.colorz?e.colorz:65793,h=null!=e.colorelse?e.colorelse:13684944;var m=new THREE.Object3D,w=GridMake2D({xmin:r,xmax:n,ymin:o,ymax:a,crossx:c,crossy:l,colorx:E,colory:x,colorelse:h}),H=GridMake2D({xmin:r,xmax:n,ymin:t,ymax:i,crossx:c,crossy:s,colorx:E,colory:u,colorelse:h});H.rotateX(Math.PI/2);var R=GridMake2D({xmin:t,xmax:i,ymin:o,ymax:a,crossx:s,crossy:l,colorx:u,colory:x,colorelse:h});return R.rotateY(-Math.PI/2),m.add(w),m.add(H),m.add(R),m}function AxisMake3D(e){var r=e.xmin,n=e.xmax,o=e.ymin,a=e.ymax,t=e.zmin,i=e.zmax,c=new THREE.Object3D,l=new THREE.Geometry;l.vertices.push(new THREE.Vector3(r,0,0),new THREE.Vector3(n,0,0));var s=new THREE.MeshBasicMaterial({color:16711680}),E=new THREE.Line(l,s);c.add(E);var x=new THREE.Geometry;x.vertices.push(new THREE.Vector3(0,o,0),new THREE.Vector3(0,a,0));var u=new THREE.MeshBasicMaterial({color:255}),h=new THREE.Line(x,u);c.add(h);var m=new THREE.Geometry;m.vertices.push(new THREE.Vector3(0,0,t),new THREE.Vector3(0,0,i));var w=new THREE.MeshBasicMaterial({color:0}),H=new THREE.Line(m,w);return c.add(H),c}function PlotPoints2D(e){var r,n,o,a,t,i,c,l,s;r=e.func,n=e.xmin,o=e.xmax,a=e.step,e.ymin,e.ymax,t=null!=e.graphxmin?e.graphxmin:n,i=null!=e.graphxmax?e.graphxmax:o,c=e.ymin,l=e.ymax,s=null!=e.colorline?e.colorline:0;var E,x=new THREE.Object3D,u=[],h=Array(),m=0,w=0;u[m]=h;for(var H=n;H<=o;H+=a){if((R=r(H)).y<=l&&R.y>=c&&R.x<=i&&R.x>=t)h[w++]=R;else{for(;(R.y>l||R.y<c||R.x>i||R.x<t)&&H<=o;){var R=r(H);H+=a}h=Array(),w=0,u[++m]=h}}for(var T=0;T<u.length;++T){h=u[T],E=new THREE.Geometry;for(var p=0;p<h.length;++p)E.vertices.push(h[p]);var y=new THREE.LineBasicMaterial({color:s}),d=new THREE.Line(E,y);x.add(d)}return x}function Form2DGraph(e){var r,n,o,a,t,i,c,l,s,E,x;r=e.func,n=null!=e.graphxmin?e.graphxmin:-10,o=null!=e.graphxmax?e.graphxmax:10,a=null!=e.linexmin?e.linexmin:n,t=null!=e.linexmax?e.linexmax:o,i=null!=e.step?e.step:(t-a)/2e3,c=null!=e.ymin?e.ymin:-10,l=null!=e.ymax?e.ymax:10,s=null!=e.crossx?e.crossx:10,E=null!=e.crossy?e.crossy:10,x=e.camera;var u=GridMake2D({xmin:n,xmax:o,ymin:c,ymax:l,crossx:s,crossy:E}),h=PlotPoints2D({func:r,xmin:a,xmax:t,graphxmin:n,graphxmax:o,step:i,ymin:c,ymax:l}),m=new THREE.Object3D;return m.add(u),m.add(h),x&&(x.position.x=(o+n)/2,x.position.y=(l+c)/2,x.position.z=2*Math.max(o-n,l-c)),m}function FormVectorField3D(e){var r,n,o,a,t,i,c,l,s,E,x,u,h,m;r=e.xmin,n=e.xmax,o=e.ymin,a=e.ymax,t=e.zmin,i=e.zmax,c=null!=e.dx?e.dx:function(e,r,n){return 0},l=null!=e.dy?e.dy:function(e,r,n){return 0},s=null!=e.dz?e.dz:function(e,r,n){return 0},E=null!=e.color?e.color:11184640,x=null!=e.colorx?e.colorx:0,u=null!=e.colory?e.colory:0,h=null!=e.colorz?e.colorz:0,m=null!=e.scale?e.scale:1;var w=new THREE.Object3D,H=GridMake3D({xmin:r,xmax:n,ymin:o,ymax:a,zmin:t,zmax:i,colorx:x,colory:u,colorz:h});w.add(H);for(var R=r;R<=n;++R)for(var T=o;T<=a;++T)for(var p=t;p<=i;++p){var y=new THREE.Vector3(R,T,p),d=c(R,T,p),v=l(R,T,p),f=s(R,T,p),M=new THREE.Vector3(d,v,f);M.normalize();var V=Math.sqrt(Math.pow(d,2)+Math.pow(v,2)+Math.pow(f,2));if(0!=V){var g=new THREE.ArrowHelper(M,y,m*V,E,m*V/3,m*V/3);w.add(g)}}return w}function FormVectorField2D(e){var r,n,o,a,t,i,c,l,s,E;if(r=e.xmin,n=e.xmax,o=e.ymin,a=e.ymax,t=null!=e.dx?e.dx:function(e,r,n){return 0},i=null!=e.dy?e.dy:function(e,r,n){return 0},c=null!=e.color?e.color:11184640,l=null!=e.scale?e.scale:1,(s=e.thickness*l||0)>0){var x=new THREE.Geometry;x.vertices.push(new THREE.Vector3(-s,1,0),new THREE.Vector3(-s,0,0),new THREE.Vector3(s,0,0),new THREE.Vector3(s,1,0)),x.faces.push(new THREE.Face3(0,1,2),new THREE.Face3(0,2,3)),x.computeBoundingSphere();var u=new THREE.MeshBasicMaterial({color:c});E=new THREE.Mesh(x,u)}var h=new THREE.Object3D,m=GridMake2D({xmin:r,xmax:n,ymin:o,ymax:a,colorx:e.gridcolorx,colory:e.gridcolory});h.add(m);for(var w=r;w<=n;++w)for(var H=o;H<=a;++H){var R=new THREE.Vector3(w,H,0),T=t(w,H),p=i(w,H),y=new THREE.Vector3(T,p,0);y.normalize();var d=Math.sqrt(Math.pow(T,2)+Math.pow(p,2));if(0!=d){var v=new THREE.ArrowHelper(new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,0),1,c,1,1);if(E){var f=E.clone();v.add(f)}d*l>.2?v.setLength(l*d,2*l,2*l):v.setLength(l*d,d*l/.6,2*l),v.position.x=R.x,v.position.y=R.y,v.position.z=R.z,v.setDirection(y),E&&(d*l>.2?v.children[2].scale.set(4*l,l*d-6*l/4,l*d):v.children[2].scale.set(4*l,l*d*l*3/4,l*d),0==T&&p<0&&v.children[2].rotation.set(0,Math.PI,0)),h.add(v)}}return h.position.z=-10,h}function FormVectorField1D(e){var r,n,o,a,t,i,c,l,s,E,x;if(r=e.xmin,n=e.xmax,o=e.ymin,a=e.ymax,t=null!=e.dx?e.dx:function(e,r,n){return 0},i=null!=e.color?e.color:11184640,c=null!=e.scale?e.scale:1,s=e.dot||!1,e.dotsizefixed||0,s){var u=new THREE.CircleGeometry(c/2,10),h=new THREE.MeshBasicMaterial({color:i});(x=new THREE.Mesh(u,h)).position.z=1}if((l=e.thickness*c||0)>0){(u=new THREE.Geometry).vertices.push(new THREE.Vector3(-l,1,0),new THREE.Vector3(-l,0,0),new THREE.Vector3(l,0,0),new THREE.Vector3(l,1,0)),u.faces.push(new THREE.Face3(0,1,2),new THREE.Face3(0,2,3)),u.computeBoundingSphere();h=new THREE.MeshBasicMaterial({color:i});E=new THREE.Mesh(u,h)}if(null!=e.tail?tail=e.tail:tail=0,0!=tail){var m=new THREE.Geometry;0!=l?m.vertices.push(new THREE.Vector3(-l/2,0,0),new THREE.Vector3(l/2,0,0),new THREE.Vector3(-l/2-.15,-.2,0),new THREE.Vector3(l/2-.15,-.2,0),new THREE.Vector3(-l/2+.15,-.2,0),new THREE.Vector3(l/2+.15,-.2,0)):m.vertices.push(new THREE.Vector3(-.1,0,0),new THREE.Vector3(.1,0,0),new THREE.Vector3(-1.1,-.2,0),new THREE.Vector3(-.9,-.2,0),new THREE.Vector3(.9,-.2,0),new THREE.Vector3(1.1,-.2,0)),m.faces.push(new THREE.Face3(0,2,1),new THREE.Face3(1,2,3),new THREE.Face3(0,4,1),new THREE.Face3(1,4,5)),m.computeBoundingSphere();var w=new THREE.MeshBasicMaterial({color:i});tailmesh=new THREE.Mesh(m,w)}var H=new THREE.Object3D,R=GridMake2D({xmin:r,xmax:n,ymin:o,ymax:a,colorx:e.gridcolorx,colory:e.gridcolory});H.add(R);for(var T=r;T<=n;++T){var p=new THREE.Vector3(T,0,0),y=t(T),d=new THREE.Vector3(y,0,0);d.normalize();var v=Math.sqrt(Math.pow(y,2));if(0!=v){var f=new THREE.ArrowHelper(new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,0),1,i,1,1);if(E){var M=E.clone();f.add(M)}if(s&&x){var V=x.clone();f.add(V)}if(0!=tail&&tailmesh){var g=tailmesh.clone();f.add(g)}f.setLength(c*v,2*c,2*c),f.position.x=p.x,f.position.y=p.y,f.position.z=p.z,f.setDirection(d),E&&f.children[2].scale.set(4*c,c*v-6*c/4,c*v),H.add(f)}}return H.position.z=-10,H}function PlotBetweenCurves(e){var r=e.indvar,n=e.min,o=e.max,a=e.funcL,t=e.funcU,i=e.xmax,c=e.ymax,l=e.scale;var s=new THREE.ParametricGeometry(function(e,s){if("x"==r)var E=a(x=(o-n)*e+n)+s*(t(x)-a(x));else if("y"==r)var x=a(E=(o-n)*e+n)+s*(t(E)-a(E));return l?new THREE.Vector3(5*x/i,5*E/c,0):new THREE.Vector3(x,E,0)},200,200),E=new THREE.MeshBasicMaterial({color:16776960,side:THREE.DoubleSide});return new THREE.Mesh(s,E)}function zoom(e){var r=camera.position.x,n=camera.position.y,o=camera.position.z,a=Math.sqrt(Math.pow(r,2)+Math.pow(n,2)+Math.pow(o,2));if(r<0)var t=Math.atan(n/r)+Math.PI;else t=Math.atan(n/r);var i=Math.acos(o/a),c=(2-(e.target?e.target:e.srcElement).value)*z0;camera.position.x=c*Math.sin(i)*Math.cos(t),camera.position.y=c*Math.sin(i)*Math.sin(t),camera.position.z=c*Math.cos(i)}function parseFunction(e){var r=new Object;function n(e){return"cos"==e||"sin"==e||"tan"==e||"acos"==e||"asin"==e||"atan"==e||"abs"==e||"sqrt"==e||"exp"==e}function o(e){return"+"==e||"-"==e||"*"==e||"/"==e||"^"==e}function a(e){return"("==e||")"==e||n(e)||o(e)}function t(e,r,n){return"^"==n?"Math.pow("+e+","+r+")":e+n+r}r[" "]=-1,r["("]=0,r["+"]=1,r["-"]=1,r["*"]=2,r["/"]=2,r["^"]=3,r.cos=4,r.sin=4,r.tan=4,r.acos=4,r.asin=4,r.atan=4,r.abs=4,r.exp=4,r.sqrt=4;for(var i=[""],c=0,l=0,s=1,E=1;" "==e[c];)c++;for(;c<e.length;c++){var x=e[c];if(" "==x){for(;" "==e[c]&&c<e.length;)c++;c!=e.length&&(c--,s=1,E=1,i.push(""),l++)}else a(x)?(s&&E||(i.push(""),l++),i[l]+=e[c],s=0,E=0):(s||(i.push(""),l++),E=0,s=1,i[l]+=e[c])}for(var u=[""],h=[" "],m=0;m<i.length;++m){var w=i[m];if(a(w)&&"("!=w&&")"!=w){for(;h.length>1&&r[w]<r[h[h.length-1]];)u.push(h.pop());h.push(w)}else if("("==w)h.push("(");else if(")"==w){for(u.push(")");"("!=h[h.length-1];)u.push(h.pop());h.pop(),u.push("(")}else u.push(w)}for(;" "!=h[h.length-1];)u.push(h.pop());u.shift();var H=[""];for(m=0;m<u.length;m++)if(o(u[m]))if("-"==u[m]&&2==H.length){var R=H.pop();H.push("-"+R)}else{var T=H.pop(),p=t(R=H.pop(),T,u[m]);H.push(p)}else if("("==u[m])"(",1==H.length?H.push("("):H[H.length-1]="("+H[H.length-1];else if(")"==u[m])H[H.length-1]+=")";else if(n(u[m])){R=H.pop();H.push("Math."+u[m]+R)}else"("==H[H.length-1]?H[H.length-1]+=u[m]:H.push(u[m]);return H.shift(),H[0]}